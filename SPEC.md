# HeyClaw Windows - 技術規格書

> Windows 版 AI 語音輸入工具

**版本：** v1.0  
**更新日期：** 2026-02-23  
**狀態：** 規格確定，待開發

---

## 📋 目錄

1. [產品概述](#1-產品概述)
2. [系統需求](#2-系統需求)
3. [功能規格](#3-功能規格)
4. [技術架構](#4-技術架構)
5. [使用者介面](#5-使用者介面)
6. [API 整合](#6-api-整合)
7. [設定檔規格](#7-設定檔規格)
8. [錯誤處理](#8-錯誤處理)
9. [開發里程碑](#9-開發里程碑)

---

## 1. 產品概述

### 1.1 產品定位
HeyClaw Windows 是一款 Windows 系統的 AI 語音輸入工具，讓使用者透過快捷鍵錄音，自動將語音轉換為文字並輸入到任何應用程式的游標位置。

### 1.2 核心價值
- **快速輸入**：說話比打字快 3-5 倍
- **AI 優化**：自動修正錯字、加標點、移除贅詞
- **無縫整合**：支援任何 Windows 應用程式

### 1.3 目標用戶
- 需要大量文字輸入的工作者
- 偏好語音輸入的使用者
- 中文/英文雙語使用者

---

## 2. 系統需求

### 2.1 硬體需求
| 項目 | 最低需求 | 建議配置 |
|------|----------|----------|
| 作業系統 | Windows 10 (21H2+) | Windows 11 |
| 記憶體 | 4 GB | 8 GB |
| 磁碟空間 | 100 MB | 200 MB |
| 麥克風 | 任意 | USB 或內建 |
| 網路 | 必須（API 呼叫） | 穩定網路 |

### 2.2 軟體需求
| 項目 | 版本 |
|------|------|
| WebView2 Runtime | 最新版（Tauri 依賴） |
| Visual C++ Runtime | 2019+ |

---

## 3. 功能規格

### 3.1 語音輸入（核心功能）

#### 3.1.1 觸發方式
| 動作 | 按鍵 | 說明 |
|------|------|------|
| 開始錄音 | `Alt + Space` | 按下後自動開始錄音 |
| 結束錄音 | `Alt` | 單獨按 Alt 結束錄音 |
| 取消錄音 | `Esc` | 取消當前錄音，不輸出 |

#### 3.1.2 完整流程
```
┌─────────────────────────────────────────────────────────────┐
│                     語音輸入流程                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [使用者按 Alt+Space]                                        │
│         │                                                    │
│         ▼                                                    │
│  ┌─────────────┐                                            │
│  │ 顯示 Overlay │ ← 紅點 + 秒數計時                          │
│  │ 開始錄音     │                                            │
│  └─────────────┘                                            │
│         │                                                    │
│         │ 使用者說話...                                      │
│         │                                                    │
│  [使用者按 Alt]                                              │
│         │                                                    │
│         ▼                                                    │
│  ┌─────────────┐                                            │
│  │ 停止錄音     │                                            │
│  │ 顯示處理中   │                                            │
│  └─────────────┘                                            │
│         │                                                    │
│         ▼                                                    │
│  ┌─────────────────────────────────────────┐                │
│  │ 1. 音訊編碼（WAV/Opus）                  │                │
│  │ 2. 呼叫 Groq Whisper API                │                │
│  │ 3. 呼叫 Groq LLM API（後處理）          │                │
│  └─────────────────────────────────────────┘                │
│         │                                                    │
│         ▼                                                    │
│  ┌─────────────┐                                            │
│  │ 複製到剪貼簿 │                                            │
│  │ 模擬 Ctrl+V │                                            │
│  │ 播放提示音   │                                            │
│  └─────────────┘                                            │
│         │                                                    │
│         ▼                                                    │
│  ┌─────────────┐                                            │
│  │ 隱藏 Overlay │                                            │
│  │ 完成        │                                            │
│  └─────────────┘                                            │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 3.1.3 錄音規格
| 參數 | 值 |
|------|-----|
| 格式 | WAV (PCM) 或 Opus |
| 取樣率 | 16000 Hz |
| 位元深度 | 16-bit |
| 聲道 | 單聲道 (Mono) |
| 最長錄音 | 60 秒 |

### 3.2 LLM 後處理

#### 3.2.1 處理內容
| 項目 | 說明 | 啟用 |
|------|------|------|
| 修正錯別字 | 同音字錯誤修正 | ✅ |
| 加標點符號 | 自動加入標點 | ✅ |
| 移除贅詞 | 移除「然後」「就是」「那個」「嗯」「啊」「對」等 | ✅ |
| 識別改口 | 「三點，不對，四點」→「四點」 | ✅ |
| 保持原意 | 不過度改寫 | ✅ |

#### 3.2.2 LLM Prompt
```
請處理以下語音轉文字結果：
1. 修正錯別字（特別是同音字）
2. 加上適當的標點符號
3. 移除口語贅詞（如「然後」「就是」「那個」「嗯」「啊」「對」）
4. 識別改口並保留最終意思
   - 當說話者用「不對」「不是」「我是說」「應該是」「等等」等詞自我修正時
   - 刪除改口詞之前被否定的部分，保留修正後的內容
   - 例如：「三點，不對，四點開會」→「四點開會」
   - 注意：「這答案不對」是評論他人，不是自我改口，應保留原句
5. 保持原意不變，不要過度改寫

原文："{text}"

只輸出處理後的文字，不要解釋。
```

#### 3.2.3 超時處理
| 情況 | 處理方式 |
|------|----------|
| LLM 回應 ≤ 5 秒 | 使用 LLM 處理後文字 |
| LLM 回應 > 5 秒 | 使用 Whisper 原文 |

### 3.3 系統托盤

#### 3.3.1 托盤選單
```
┌─────────────────┐
│ 📝 HeyClaw      │
├─────────────────┤
│ ⚙️ 設定         │
│ 📜 歷史紀錄     │
├─────────────────┤
│ ❌ 結束         │
└─────────────────┘
```

### 3.4 設定介面

#### 3.4.1 設定項目
| 分類 | 設定項 | 類型 | 預設值 |
|------|--------|------|--------|
| API | Groq API Key | 文字 | 必填 |
| 語言 | 偏好語言 | 選單 | zh-TW |
| 快捷鍵 | 錄音快捷鍵 | 熱鍵 | Alt+Space |
| 音效 | 完成提示音 | 開關 | 開啟 |
| 啟動 | 開機自動啟動 | 開關 | 關閉 |

---

## 4. 技術架構

### 4.1 系統架構圖
```
┌─────────────────────────────────────────────────────────────┐
│                        HeyClaw Windows                       │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────────────────┐    ┌────────────────────┐          │
│  │    前端 (React)     │    │   系統托盤 (Tauri)  │          │
│  │  ┌──────────────┐  │    │                    │          │
│  │  │   Overlay    │  │    │  ┌──────────────┐  │          │
│  │  │  (錄音狀態)   │  │    │  │   托盤圖示   │  │          │
│  │  └──────────────┘  │    │  │   托盤選單   │  │          │
│  │  ┌──────────────┐  │    │  └──────────────┘  │          │
│  │  │   設定頁面   │  │    │                    │          │
│  │  └──────────────┘  │    │                    │          │
│  └────────────────────┘    └────────────────────┘          │
│              │                        │                     │
│              └────────┬───────────────┘                     │
│                       │                                     │
│                       ▼                                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  Tauri 後端 (Rust)                   │   │
│  │                                                      │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐    │   │
│  │  │ 全域快捷鍵 │  │  音訊錄製  │  │  輸入模擬  │    │   │
│  │  │ (global-   │  │   (cpal)   │  │ (clipboard │    │   │
│  │  │  shortcut) │  │            │  │  + Ctrl+V) │    │   │
│  │  └────────────┘  └────────────┘  └────────────┘    │   │
│  │         │              │               │            │   │
│  │         └──────────────┼───────────────┘            │   │
│  │                        │                            │   │
│  │                        ▼                            │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │              API 模組 (reqwest)              │   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  │         │                      │                   │   │
│  └─────────┼──────────────────────┼───────────────────┘   │
│            │                      │                        │
└────────────┼──────────────────────┼────────────────────────┘
             │                      │
             ▼                      ▼
    ┌─────────────────┐    ┌─────────────────┐
    │  Groq Whisper   │    │   Groq LLM      │
    │  API            │    │   API           │
    │  (語音轉文字)    │    │  (後處理修正)   │
    └─────────────────┘    └─────────────────┘
```

### 4.2 技術選擇

#### 4.2.1 框架
| 層級 | 技術 | 版本 | 說明 |
|------|------|------|------|
| 桌面框架 | Tauri | v2 | 輕量、安全、原生 |
| 前端 | React | 18+ | 元件化 UI |
| 語言 | TypeScript | 5+ | 類型安全 |
| 建置 | Vite | 5+ | 快速建置 |

#### 4.2.2 Rust 依賴
| Crate | 版本 | 用途 |
|-------|------|------|
| `cpal` | latest | 音訊錄製 |
| `hound` | latest | WAV 編碼 |
| `reqwest` | latest | HTTP 請求 |
| `serde` | latest | JSON 序列化 |
| `arboard` | latest | 剪貼簿操作 |
| `enigo` | latest | 鍵盤模擬 (備用) |

#### 4.2.3 Tauri 插件
| 插件 | 用途 |
|------|------|
| `tauri-plugin-global-shortcut` | 全域快捷鍵 |
| `tauri-plugin-notification` | 系統通知 |
| `tauri-plugin-store` | 本地儲存 |
| `tauri-plugin-autostart` | 開機啟動 |

---

## 5. 使用者介面

### 5.1 錄音 Overlay

#### 5.1.1 設計規格
| 屬性 | 值 |
|------|-----|
| 位置 | 螢幕中央 |
| 大小 | 120 x 40 px |
| 形狀 | 藥丸形 (pill) |
| 背景 | 半透明黑色 (#000000, 80%) |
| 圓角 | 20px |

#### 5.1.2 狀態顯示
| 狀態 | 顯示內容 |
|------|----------|
| 錄音中 | 🔴 + `00:05` (秒數計時) |
| 處理中 | ⏳ + `處理中...` |
| 完成 | ✅ (短暫顯示後消失) |
| 錯誤 | ❌ + 錯誤訊息 |

#### 5.1.3 視覺設計
```
┌──────────────────────────┐
│  🔴  00:05               │  ← 錄音中
└──────────────────────────┘

┌──────────────────────────┐
│  ⏳  處理中...            │  ← 處理中
└──────────────────────────┘
```

### 5.2 設定視窗

#### 5.2.1 佈局
```
┌─────────────────────────────────────────┐
│  ⚙️ HeyClaw 設定                    [X] │
├─────────────────────────────────────────┤
│                                         │
│  🔑 API 設定                            │
│  ┌─────────────────────────────────┐   │
│  │ Groq API Key: [gsk_••••••••••]  │   │
│  └─────────────────────────────────┘   │
│                                         │
│  🌐 語言設定                            │
│  ┌─────────────────────────────────┐   │
│  │ 偏好語言: [繁體中文 ▼]           │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ⌨️ 快捷鍵設定                          │
│  ┌─────────────────────────────────┐   │
│  │ 錄音快捷鍵: [Alt + Space]       │   │
│  └─────────────────────────────────┘   │
│                                         │
│  🔊 音效設定                            │
│  ┌─────────────────────────────────┐   │
│  │ [✓] 完成提示音                   │   │
│  └─────────────────────────────────┘   │
│                                         │
│  🚀 啟動設定                            │
│  ┌─────────────────────────────────┐   │
│  │ [ ] 開機自動啟動                 │   │
│  └─────────────────────────────────┘   │
│                                         │
│           [儲存設定]  [取消]            │
│                                         │
└─────────────────────────────────────────┘
```

---

## 6. API 整合

### 6.1 Groq Whisper API

#### 6.1.1 端點
```
POST https://api.groq.com/openai/v1/audio/transcriptions
```

#### 6.1.2 請求格式
```json
{
  "file": "<audio_file>",
  "model": "whisper-large-v3-turbo",
  "language": "zh",
  "response_format": "json"
}
```

#### 6.1.3 回應格式
```json
{
  "text": "今天天氣很好"
}
```

### 6.2 Groq LLM API

#### 6.2.1 端點
```
POST https://api.groq.com/openai/v1/chat/completions
```

#### 6.2.2 請求格式
```json
{
  "model": "llama-3.3-70b-versatile",
  "messages": [
    {
      "role": "user",
      "content": "請處理以下語音轉文字結果：\n1. 修正錯別字（特別是同音字）\n2. 加上適當的標點符號\n3. 移除口語贅詞（如「然後」「就是」「那個」「嗯」「啊」「對」）\n4. 識別改口並保留最終意思\n   - 當說話者用「不對」「不是」「我是說」「應該是」「等等」等詞自我修正時\n   - 刪除改口詞之前被否定的部分，保留修正後的內容\n   - 例如：「三點，不對，四點開會」→「四點開會」\n   - 注意：「這答案不對」是評論他人，不是自我改口，應保留原句\n5. 保持原意不變，不要過度改寫\n\n原文：\"今天天氣很好然後我想說那個我們三點不對四點可以去公園\"\n\n只輸出處理後的文字，不要解釋。"
    }
  ],
  "max_tokens": 1000,
  "temperature": 0.1
}
```

#### 6.2.3 回應格式
```json
{
  "choices": [
    {
      "message": {
        "content": "今天天氣很好，我想說我們可以去公園。"
      }
    }
  ]
}
```

---

## 7. 設定檔規格

### 7.1 CONFIG.JSON

#### 7.1.1 檔案位置
```
%APPDATA%\HeyClaw\CONFIG.JSON
```

#### 7.1.2 完整結構
```json
{
  "version": "1.0",
  "api": {
    "groq_api_key": "gsk_xxxxxxxxxxxxxxxxxxxxxxxx"
  },
  "whisper": {
    "model": "whisper-large-v3-turbo",
    "language": "zh"
  },
  "llm": {
    "model": "llama-3.3-70b-versatile",
    "enabled": true,
    "timeout_seconds": 5,
    "prompt": "請處理以下語音轉文字結果：\n1. 修正錯別字（特別是同音字）\n2. 加上適當的標點符號\n3. 移除口語贅詞（如「然後」「就是」「那個」「嗯」「啊」「對」）\n4. 識別改口並保留最終意思（例如：「三點，不對，四點」→「四點」）\n5. 保持原意不變，不要過度改寫\n\n原文：\"{text}\"\n\n只輸出處理後的文字，不要解釋。"
  },
  "shortcuts": {
    "start_recording": "Alt+Space",
    "stop_recording": "Alt",
    "cancel_recording": "Escape"
  },
  "audio": {
    "sample_rate": 16000,
    "channels": 1,
    "max_duration_seconds": 60
  },
  "ui": {
    "overlay_position": "center",
    "sound_effects": true
  },
  "system": {
    "auto_start": false,
    "minimize_to_tray": true
  }
}
```

---

## 8. 錯誤處理

### 8.1 錯誤類型與處理

| 錯誤類型 | 偵測方式 | 處理方式 | 使用者提示 |
|----------|----------|----------|------------|
| API 逾時 | HTTP timeout | 重試 1 次 | 「連線逾時，重試中...」 |
| 網路斷線 | 無法連線 | 顯示錯誤 | 「無法連線，請檢查網路」 |
| API Key 無效 | 401 錯誤 | 停止並提示 | 「API Key 無效，請檢查設定」 |
| 麥克風佔用 | 錄音失敗 | 顯示錯誤 | 「麥克風被佔用，請關閉其他應用」 |
| LLM 超時 | 超過 5 秒 | 使用原文 | 靜默處理 |
| 快捷鍵衝突 | 註冊失敗 | 提示更換 | 「快捷鍵被佔用，請更換」 |

### 8.2 重試策略

```
第 1 次失敗 → 等待 1 秒 → 重試
第 2 次失敗 → 顯示錯誤，停止重試
```

---

## 9. 開發里程碑

### 9.1 Phase 1：基礎建設（Week 1）

**預估工時：** 8-12 小時

**目標：** 驗證核心技術可行性

| 任務 | 工時 | 驗收標準 |
|------|------|----------|
| 初始化 Tauri v2 專案 | 1h | `cargo tauri dev` 可執行 |
| 設定 React + Vite | 1h | 前端可運行 |
| 實作系統托盤 | 2h | 托盤圖示顯示 |
| 測試全域快捷鍵 | 2h | Alt+Space 觸發事件 |
| 測試 cpal 錄音 | 3h | 可錄製並播放音訊 |
| 測試剪貼簿+Ctrl+V | 2h | 可輸入文字到記事本 |

### 9.2 Phase 2：核心功能 - MVP（Week 2）

**預估工時：** 10-15 小時

**目標：** 完成語音輸入流程

| 任務 | 工時 | 驗收標準 |
|------|------|----------|
| 錄音模組 | 3h | 開始/停止/取消 |
| WAV 編碼 | 2h | 正確編碼 |
| Groq Whisper API | 3h | 成功轉錄 |
| 剪貼簿輸入 | 2h | 文字正確輸入 |
| Overlay UI | 3h | 顯示錄音狀態 |
| 整合測試 | 2h | 端到端流程 |

**MVP 驗收：**
```
按 Alt+Space → 說「今天天氣很好」→ 按 Alt → 文字出現在游標
```

### 9.3 Phase 3：LLM 後處理（Week 3）

**預估工時：** 8-10 小時

| 任務 | 工時 |
|------|------|
| Groq LLM API | 2h |
| Prompt 實作 | 1h |
| 超時處理 | 2h |
| 設定介面 | 3h |
| 語言選擇 | 1h |

### 9.4 Phase 4：完善功能（Week 4）

**預估工時：** 8-10 小時

| 任務 | 工時 |
|------|------|
| 錯誤處理完善 | 2h |
| 音效提示 | 1h |
| 開機啟動 | 1h |
| 設定持久化 | 2h |
| UI 美化 | 2h |

### 9.5 Phase 5：打包發布（Week 5）

**預估工時：** 6-8 小時

| 任務 | 工時 |
|------|------|
| Windows 打包 | 2h |
| 安裝程式 | 2h |
| 文件撰寫 | 2h |
| GitHub Release | 1h |

---

## 📊 總工時估算

| Phase | 工時 |
|-------|------|
| Phase 1 | 8-12h |
| Phase 2 (MVP) | 10-15h |
| Phase 3 | 8-10h |
| Phase 4 | 8-10h |
| Phase 5 | 6-8h |
| **總計** | **40-55h** |

---

## 📝 附錄

### A. 參考專案
- [Handy](https://github.com/cjpais/Handy) - 開源跨平台語音輸入
- [heyclaw](https://github.com/xdite/heyclaw) - macOS 版參考
- [Typeless](https://typeless.com) - 商業 AI 語音輸入

### B. 文件更新紀錄
| 日期 | 版本 | 變更 |
|------|------|------|
| 2026-02-23 | 1.0 | 初版規格確定 |

---

*本規格書由小八 🐱 與兔兔 🐰 協作完成*
